<div *ngFor="let _ of [].constructor(mapInformacionGuardadaDeAtributo.get(objectToString(ubicacionAbsolutaDeAtributo(atributo.ubicacion,atributo.id)))!.cantidadInstancias); index as indiceInstancia;" class="atr-container">
    <div *ngIf="indiceInstancia === 0 && atributo.nombre" class="row">
        <h5>{{ atributo.nombre ? atributo.nombre+' ' : '' }}
            <span *ngIf="atributo.ayuda" class="d-inline-block" data-bs-toggle="popover" data-bs-trigger="hover focus" [attr.data-bs-content]="atributo.ayuda" data-bs-custom-class="custom-popover">
                <i class="bi bi-question-circle-fill p-2" style="color: #616161; cursor: pointer;"></i>
            </span>
        </h5>
    </div>

    <!-- punto critico -->
    <div *ngIf="indiceInstancia==0 && atributo.puntoCritico" class="accordion pb-4">
        <div *ngIf="atributo.puntoCritico.normativa" class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#contenidoNormativa">
                Normativa
            </button>
            </h2>
            <div id="contenidoNormativa" class="accordion-collapse collapse collapse">
                <div class="accordion-body" [innerHTML]="addLinkHTML(atributo.puntoCritico.normativa)"></div>
            </div>
        </div>
        <div *ngIf="atributo.puntoCritico.informacionAmpliatoria" class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#contenidoInformacionAmpliatoria">
                Información Ampliatoria
            </button>
            </h2>
            <div id="contenidoInformacionAmpliatoria" class="accordion-collapse collapse">
                <div class="accordion-body" [innerHTML]="addLinkHTML(atributo.puntoCritico.informacionAmpliatoria)"></div>
            </div>
        </div>
        <div *ngIf="atributo.puntoCritico.aporteConceptual" class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#contenidoAporteConceptual">
                Aporte Conceptual
            </button>
            </h2>
            <div id="contenidoAporteConceptual" class="accordion-collapse collapse">
                <div class="accordion-body" [innerHTML]="addLinkHTML(atributo.puntoCritico.aporteConceptual)"></div>
            </div>
        </div>
    </div>

    <!-- subir archivos -->
    <input type="file" (change)="onFileSelected($event)" #fileUploader style="display:none">
    <a #fileDownloader style="display:none"></a>
    <div *ngIf="indiceInstancia==0 && atributo.herencia && atributoHerencia && atributoHerencia!.filasDatos" class="d-flex flex-column pb-2 pt-2 align-items-end">
        <button class="btn btn-outline-primary" role="button" style="font-size: 12px; border: none;" data-bs-toggle="popover" data-bs-trigger="hover focus" [attr.data-bs-content]="'Podras cargar este dato con la información cargada en la sección ' + grupoHerencia!.nombre + ' de ' + etapaHerencia!.nombre"
            data-bs-custom-class="custom-popover" (click)="cargarDatosDesdeHerencia(atributo)">
            <!-- (click)="openModal('eliminar')" -->
            <i class="bi bi-arrow-bar-down pe-2"></i>CARGAR DATOS DESDE {{grupoHerencia!.nombre | uppercase}} DE {{etapaHerencia!.nombre | uppercase}}
        </button>
    </div>

    <!-- Primero muestro los atributos que son HERENCIA -->
    <div *ngIf="atributo.herencia && atributoHerencia && atributoHerencia!.filasDatos">
        <div *ngFor="let fila of atributoHerencia!.filasDatos" class="row">
            <div *ngFor="let dato of fila.datos" class="col">
                <div class="mb-3">
                    <label class="form-label pt-2">
                        {{ dato.nombre ? dato.nombre+' ' : "&nbsp;" }}
                        <span *ngIf="dato.ayuda" 
                            class="d-inline-block" 
                            data-bs-toggle="popover" 
                            data-bs-trigger="hover focus" 
                            [attr.data-bs-content]="dato.ayuda"
                            data-bs-custom-class="custom-popover"
                        >
                            <i class="bi bi-question-circle-fill p-2" style="color: #616161; cursor: pointer;"></i>
                        </span>
                    </label>
                    <!-- Codigo computo -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.computo))">
                        <p>{{ mapValoresComputados.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))!.valor }}</p>
                    </ng-container>
                    <!-- Codigo text -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.text))">
                        <input *ngIf="dato.tamanio < 200" class="form-control" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" [type]="dato.tipo" [placeholder]="dato.nombre || ''"
                            (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)">
                        <textarea *ngIf="dato.tamanio > 199" class="form-control" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" [rows]="(dato.tamanio/100)"
                            [placeholder]="dato.nombre || ''" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)"></textarea>
                    </ng-container>
                    <!-- Codigo number -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.number))">
                        <input class="form-control" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)"
                            [type]="dato.tipo" [placeholder]="dato.nombre || ''">
                    </ng-container>
                    <!-- Codigo selectFijoUnico -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.selectFijoUnico))">
                        <select class="form-select" (change)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)">
                            <ng-container *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))">
                                <option 
                                    *ngIf="muestroOpcion(opcion.muestroSi,indiceInstancia)"
                                    [selected]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,opcion.valor)"
                                    value={{opcion.valor}}
                                >
                                    {{ opcion.string }}
                                </option>
                            </ng-container>
                        </select>
                    </ng-container>
                    <!-- Codigo selectFijoMultiple -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.selectFijoMultiple))">
                        <mat-form-field appearance="fill">
                            <mat-label>{{ dato.nombre ? dato.nombre : "Seleccione" }}</mat-label>
                            <mat-select multiple (selectionChange)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)">
                                <mat-option *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))" [value]="opcion.valor">
                                    {{opcion.string}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </ng-container>
                    <!-- Codigo radio -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.radio))">
                        <ng-container *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))">
                            <div class="form-check">
                                <input type="radio" (click)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)" [attr.checked]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,opcion.valor) ? '' : null"
                                    value={{objectToString(opcion.valor)}} class="form-check-input" [name]="objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id))">
                                <label class="form-check-label">{{opcion.string}}</label>
                            </div>
                        </ng-container>
                    </ng-container>
                    <!-- Codigo date -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.date))">
                        <div class="input-group">
                            <input class="form-control" type="date" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" (change)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)">
                            <!-- <button class="btn btn-outline-primary bi bi-calendar-event" (click)="d.toggle()" type="button"></button> -->
                        </div>
                    </ng-container>
                    <!-- Codigo porcentaje -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.porcentaje))">
                        <fieldset [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)">
                            <input class="form-control" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)" [type]="mapTipoInputHTML.get(enumTiposInput.porcentaje)" [placeholder]="dato.nombre || ''" [formControl]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)"
                                [ngClass]="{ 'is-invalid': mapControlesCampos.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id))+indiceInstancia)!.invalid }">
                            <div *ngIf="mapControlesCampos.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id))+indiceInstancia)!.invalid" class="invalid-feedback">
                                Porcentaje debe estar entre 0 y 100.
                            </div>
                        </fieldset>
                    </ng-container>
                    <!-- Codigo archivo -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.archivo))">
                        <div class="row align-items-center">
                            <!-- Texto -->
                            <div class="col">
                                <input class="form-control" type="text" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,'Texto')" [placeholder]="dato.nombre || ''" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)">
                            </div>

                            <!-- Si existe archivo -->
                            <ng-container *ngIf="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,'ExisteFile')">
                                <!-- Descargar archivo -->
                                <div class="col-auto d-block p-0" style="width: 0px;">
                                    <i title="Descargar archivo" (click)="downloadUserFile(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" class="bi bi-file-earmark-check fs-5 position-relative " style="right: 44px; color: #0d6efd;cursor: pointer;"></i>
                                </div>
                                <!-- Eliminar archivo -->
                                <div class="col-auto">
                                    <button (click)="eliminarArchivo(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" title="Desvincular archivo"><i class="bi bi-trash-fill fs-5"></i></button>
                                </div>
                            </ng-container>

                            <!-- Si NO existe archivo -->
                            <ng-container *ngIf="!cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,'ExisteFile')">
                                <!-- Subir archivo archivo -->
                                <div class="col-auto">
                                    <button (click)="openSelectFileDialog(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" title="Agregar archivo"><i class="bi bi-file-earmark-plus-fill fs-5"></i></button>
                                </div>
                            </ng-container>

                            <!-- Agrego link a Dato tipo archivo -->
                            <div class="col-auto">
                                <button (click)="openModalAgrergoLinkArchivo(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" title="Agregar enlace a sitio"><i class="bi bi-link fs-5"></i></button>
                            </div>
                        </div>
                    </ng-container>
                    <!-- Codigo selectUsuarioMultiple -->
                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.selectUsuarioMultiple))">
                        <mat-form-field appearance="fill">
                            <mat-label>{{ dato.nombre ? dato.nombre : "Seleccione" }}</mat-label>
                            <mat-select multiple (selectionChange)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)">
                                <mat-option *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))" [value]="opcion.valor">
                                    {{opcion.string}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </ng-container>
                </div>
            </div>
            <ng-container *ngIf="atributo.multiInstanciable">
                <div class="col-auto align-self-center">
                    <button type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" (click)="modalConfirmacion(atributo.ubicacion,atributo.id,indiceInstancia)">
                        <i class="bi bi-trash-fill fs-5"></i>
                    </button>
                </div>
            </ng-container>
        </div>
    </div>
    <!-- Muestro las filas de datos propias del atributo -->
    <ng-container *ngIf="atributo.filasDatos !== null">
        <div class="card mb-4 bg-transparent">
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <div *ngFor="let fila of atributo.filasDatos" class="row">
                            <div *ngFor="let dato of fila.datos" class="col">
                                <div class="mb-3">
                                    <!--
                                        date,
                                        dateLog
                                    -->
                                    <label class="form-label pt-2">
                                        {{ dato.nombre ? dato.nombre+' ' : "&nbsp;" }}
                                        <span *ngIf="dato.ayuda"
                                            class="d-inline-block"
                                            data-bs-toggle="popover"
                                            data-bs-trigger="hover focus"
                                            [attr.data-bs-content]="dato.ayuda"
                                            data-bs-custom-class="custom-popover"
                                        >
                                            <i class="bi bi-question-circle-fill p-2" style="color: #616161; cursor: pointer;"></i>
                                        </span>
                                    </label>
                                    <!-- Codigo contenidoCondicional -->
                                    <ng-container *ngIf="dato.filasDatos !== null && mapContenidoCondicional.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,indiceInstancia)))">
                                        <!-- REPITO SEGUN CANTIDAD DE INSTANCIAS DE ESTE DATO
                                        <div *ngFor="let item of testObject | keyvalue">
                                            Key: <b>{{item.key}}</b> and Value: <b>{{item.value}}</b>
                                        </div>-->
                                        <ng-container *ngFor="let contCondicional of mapContenidoCondicional.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,indiceInstancia))); index as indiceInstanciaDeDato;">
                                            <!--                                                            [  Unidad 0   ,  Unidad 1   ,  Unidad 2  ,  Unidad 3   ] -->
                                            <!-- mapContenidoCondicional.get( 2,24,3,[instanciaModulo] ) -> [ FilaDatos[] , FilaDatos[] , FilaDatos[], FilaDatos[] ] -->
                                            <div class="card border-secondary mb-4" style="background-color: transparent !important;">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col">
                                                            <div *ngFor="let filaInterior of dato.filasDatos" class="row">
                                                                <div *ngFor="let datoInterior of filaInterior.datos" class="col">
                                                                    <div class="mb-3">
                                                                        <label class="form-label pt-2">
                                                                            {{ datoInterior.nombre ? datoInterior.nombre+' ' : "&nbsp;" }}
                                                                            <span *ngIf="datoInterior.ayuda"
                                                                                class="d-inline-block"
                                                                                data-bs-toggle="popover"
                                                                                data-bs-trigger="hover focus"
                                                                                [attr.data-bs-content]="datoInterior.ayuda"
                                                                                data-bs-custom-class="custom-popover"
                                                                            >
                                                                                <i class="bi bi-question-circle-fill p-2" style="color: #616161; cursor: pointer;"></i>
                                                                            </span>
                                                                        </label>
                                                                        <!-- selectFijoUnico que determina el contenido condicional a mostrar -->
                                                                        <ng-container *ngIf="datoInterior.tipo === (mapTipoInput.get(enumTiposInput.selectFijoUnico))">
                                                                            <select class="form-select" 
                                                                                (change)="guardarCambioContenidoCondicional(datoInterior.ubicacion,datoInterior.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoInterior.tipo)!,$event.target)"
                                                                            >
                                                                                <ng-container *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(datoInterior.ubicacion,datoInterior.id)))">
                                                                                    <option
                                                                                        [selected]="cargarInfoPreviaContenidoCondicional(datoInterior.ubicacion,datoInterior.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoInterior.tipo)!,opcion.valor)"
                                                                                        value={{opcion.valor}}
                                                                                    >
                                                                                        {{ opcion.string }}
                                                                                    </option>
                                                                                </ng-container>
                                                                            </select>
                                                                        </ng-container>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <!-- contenido condicional mostrado -->
                                                            <div *ngFor="let filaContCond of contCondicional" class="row">
                                                                <div *ngFor="let datoContCond of filaContCond.datos" class="col">
                                                                    <div class="mb-3">
                                                                        <label class="form-label pt-2">
                                                                            {{ datoContCond.nombre ? datoContCond.nombre+' ' : "&nbsp;" }}
                                                                            <span *ngIf="datoContCond.ayuda"
                                                                                class="d-inline-block"
                                                                                data-bs-toggle="popover"
                                                                                data-bs-trigger="hover focus"
                                                                                [attr.data-bs-content]="datoContCond.ayuda"
                                                                                data-bs-custom-class="custom-popover"
                                                                            >
                                                                                <i class="bi bi-question-circle-fill p-2" style="color: #616161; cursor: pointer;"></i>
                                                                            </span>
                                                                        </label>
                                                                        <!-- Codigo text -->
                                                                        <ng-container *ngIf="datoContCond.tipo === (mapTipoInput.get(enumTiposInput.text))">
                                                                            <input *ngIf="datoContCond.tamanio < 200" class="form-control" [type]="datoContCond.tipo" [placeholder]="datoContCond.nombre || ''" (keyup)="guardarCambioContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,$event.target)"
                                                                                [ngModel]="cargarInfoPreviaContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,null)">
                                                                            <textarea *ngIf="datoContCond.tamanio > 199" class="form-control" [rows]="(datoContCond.tamanio/100)" [placeholder]="datoContCond.nombre || ''" (keyup)="guardarCambioContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,$event.target)"
                                                                                [ngModel]="cargarInfoPreviaContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,null)"></textarea>
                                                                        </ng-container>
                                                                        <!-- Codigo number -->
                                                                        <ng-container *ngIf="datoContCond.tipo === (mapTipoInput.get(enumTiposInput.number))">
                                                                            <input class="form-control" (keyup)="guardarCambioContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,$event.target)" [ngModel]="cargarInfoPreviaContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,null)"
                                                                                [type]="datoContCond.tipo" [placeholder]="datoContCond.nombre || ''">
                                                                        </ng-container>
                                                                        <!-- Codigo date -->
                                                                        <ng-container *ngIf="datoContCond.tipo === (mapTipoInput.get(enumTiposInput.date))">
                                                                            <div class="input-group">
                                                                                <input class="form-control" type="date" [ngModel]="cargarInfoPreviaContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,null)" (change)="guardarCambioContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,$event.target)">
                                                                            </div>
                                                                        </ng-container>
                                                                        <!-- Codigo selectUsuarioMultiple -->
                                                                        <ng-container *ngIf="datoContCond.tipo === (mapTipoInput.get(enumTiposInput.selectUsuarioMultiple))">
                                                                            <mat-form-field appearance="fill">
                                                                                <mat-label>{{ datoContCond.nombre ? datoContCond.nombre : "Seleccione" }}</mat-label>
                                                                                <mat-select multiple (selectionChange)="guardarCambioContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,$event)" [ngModel]="cargarInfoPreviaContenidoCondicional(datoContCond.ubicacion,datoContCond.id,indiceInstancia,indiceInstanciaDeDato,mapTipoInput.revGet(datoContCond.tipo)!,null)">
                                                                                    <!-- Necesito: 
                                                                                        Por ejemplo, Padre (modulo) indice 0, Hijo (unidad) indice 1, dato 2
                                                                                        "{"idEtapa":2,"idGrupo":24,"idAtributo":3,"idDato":[0]},1,2"-->
                                                                                    <mat-option *ngFor="let opcion of mapOpcionesSelect.get(obtenerClaveSelectCondicional(datoContCond.ubicacion,indiceInstancia,indiceInstanciaDeDato,datoContCond.id))" [value]="opcion.valor">
                                                                                        {{opcion.string}}
                                                                                    </mat-option>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </ng-container>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div *ngIf="dato.multiInstanciable" class="col-auto align-self-center">
                                                            <button type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" (click)="modalEliminarUnidad(atributo.ubicacion,atributo.id,dato,indiceInstancia,indiceInstanciaDeDato)">
                                                                <i class="bi bi-trash-fill fs-5"></i>
                                                                <!-- aca elimino las unidades de mas adentro -->
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </ng-container>
                                        <div *ngIf="atributo.multiInstanciable">
                                            <button type="button" class="btn btn-outline-primary background-primary m-2 w-100" (click)="agregarUnidades(dato,atributo.ubicacion,atributo.id,indiceInstancia)" style="font-weight:500;">
                                                <i _ngcontent-ofn-c89="" class="bi bi-plus-square-dotted me-2"></i>
                                                Agregar {{ dato.nombre }}
                                            </button>
                                        </div>
                                    </ng-container>
                                    <!-- Codigo computo -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.computo))">
                                        <p>{{ mapValoresComputados.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))!.valor }}</p>
                                    </ng-container>
                                    <!-- Codigo text -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.text))">
                                        <input *ngIf="dato.tamanio < 200" class="form-control" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" [type]="dato.tipo" [placeholder]="dato.nombre || ''"
                                            (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)">
                                        <textarea *ngIf="dato.tamanio > 199" class="form-control" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" [rows]="(dato.tamanio/100)"
                                            [placeholder]="dato.nombre || ''" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)"></textarea>
                                    </ng-container>
                                    <!-- Codigo number -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.number))">
                                        <input class="form-control" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)"
                                            [type]="dato.tipo" [placeholder]="dato.nombre || ''">
                                    </ng-container>
                                    <!-- Codigo selectFijoUnico -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.selectFijoUnico))">
                                        <select class="form-select" (change)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)">
                                            <ng-container *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))">
                                                <option
                                                    *ngIf="muestroOpcion(opcion.muestroSi,indiceInstancia)"
                                                    [selected]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,opcion.valor)"
                                                    value={{opcion.valor}}
                                                >
                                                    {{ opcion.string }}
                                                </option>
                                            </ng-container>
                                        </select>
                                    </ng-container>
                                    <!-- Codigo selectFijoMultiple -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.selectFijoMultiple))">
                                        <mat-form-field appearance="fill">
                                            <mat-label>{{ dato.nombre ? dato.nombre : "Seleccione" }}</mat-label>
                                            <mat-select multiple (selectionChange)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)">
                                                <mat-option *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))" [value]="opcion.valor">
                                                    {{opcion.string}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </ng-container>
                                    <!-- Codigo radio -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.radio))">
                                        <ng-container *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))">
                                            <div class="form-check">
                                                <input type="radio" (click)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)" [attr.checked]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,opcion.valor) ? '' : null"
                                                    value={{objectToString(opcion.valor)}} class="form-check-input" [name]="objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id))">
                                                <label class="form-check-label">{{opcion.string}}</label>
                                            </div>
                                        </ng-container>
                                    </ng-container>
                                    <!-- Codigo date -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.date))">
                                        <div class="input-group">

                                            <input class="form-control" type="date" [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)" (change)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)">
                                            <!-- <button class="btn btn-outline-primary bi bi-calendar-event" (click)="d.toggle()" type="button"></button> -->
                                        </div>
                                    </ng-container>
                                    <!-- Codigo porcentaje -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.porcentaje))">
                                        <fieldset [disabled]="estaDeshabilitado(dato.habilitadoSi,indiceInstancia)">
                                            <input class="form-control" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)" [type]="mapTipoInputHTML.get(enumTiposInput.porcentaje)" [placeholder]="dato.nombre || ''" [formControl]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)"
                                                [ngClass]="{ 'is-invalid': mapControlesCampos.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id))+indiceInstancia)!.invalid }">
                                            <div *ngIf="mapControlesCampos.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id))+indiceInstancia)!.invalid" class="invalid-feedback">
                                                Porcentaje debe estar entre 0 y 100.
                                            </div>
                                        </fieldset>
                                    </ng-container>
                                    <!-- Codigo archivo -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.archivo))">
                                        <div class="row align-items-center">
                                            <!-- Texto -->
                                            <div class="col">
                                                <input class="form-control" type="text" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,'Texto')" [placeholder]="dato.nombre || ''" (keyup)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event.target)">
                                            </div>

                                            <!-- Si existe archivo -->
                                            <ng-container *ngIf="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,'ExisteFile')">
                                                <!-- Descargar archivo -->
                                                <div class="col-auto d-block p-0" style="width: 0px;">
                                                    <i title="Descargar archivo" (click)="downloadUserFile(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" class="bi bi-file-earmark-check fs-5 position-relative " style="right: 44px; color: #0d6efd;cursor: pointer;"></i>
                                                </div>
                                                <!-- Eliminar archivo -->
                                                <div class="col-auto">
                                                    <button (click)="eliminarArchivo(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" title="Desvincular archivo"><i class="bi bi-trash-fill fs-5"></i></button>
                                                </div>
                                            </ng-container>

                                            <!-- Si NO existe archivo -->
                                            <ng-container *ngIf="!cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,'ExisteFile')">
                                                <!-- Subir archivo archivo -->
                                                <div class="col-auto">
                                                    <button (click)="openSelectFileDialog(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" title="Agregar archivo"><i class="bi bi-file-earmark-plus-fill fs-5"></i></button>
                                                </div>
                                            </ng-container>

                                            <!-- Agrego link a Dato tipo archivo -->
                                            <div class="col-auto">
                                                <button (click)="openModalAgrergoLinkArchivo(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id),indiceInstancia)" type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" title="Agregar enlace a sitio"><i class="bi bi-link fs-5"></i></button>
                                            </div>
                                        </div>
                                    </ng-container>
                                    <!-- Codigo selectUsuarioMultiple -->
                                    <ng-container *ngIf="dato.tipo === (mapTipoInput.get(enumTiposInput.selectUsuarioMultiple))">
                                        <mat-form-field appearance="fill">
                                            <mat-label>{{ dato.nombre ? dato.nombre : "Seleccione" }}</mat-label>
                                            <mat-select multiple (selectionChange)="guardarCambio(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,$event)" [ngModel]="cargarInfoPrevia(dato.ubicacion,dato.id,indiceInstancia,mapTipoInput.revGet(dato.tipo)!,null)">
                                                <mat-option *ngFor="let opcion of mapOpcionesSelect.get(objectToString(ubicacionAbsolutaDeDato(dato.ubicacion,dato.id)))" [value]="opcion.valor">
                                                    {{opcion.string}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="atributo.multiInstanciable" class="col-auto align-self-center">
                        <button type="button" class="btn btn-outline-primary background-primary" style="padding-top:3px;padding-bottom:3px;" (click)="modalConfirmacion(atributo.ubicacion,atributo.id,indiceInstancia)">
                            <i class="bi bi-trash-fill fs-5"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>
<div *ngIf="atributo.multiInstanciable">
    <button type="button" class="btn btn-outline-primary background-primary m-2 w-100" (click)="agregarInstanciaAtributo(atributo.ubicacion,atributo.id)" style="font-weight:500;">
        <i _ngcontent-ofn-c89="" class="bi bi-plus-square-dotted me-2"></i>
        Agregar {{ atributo.nombre }}
    </button>
</div>